var G=Object.defineProperty,R=Object.defineProperties;var H=Object.getOwnPropertyDescriptors;var N=Object.getOwnPropertySymbols;var J=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable;var T=(e,o,i)=>o in e?G(e,o,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[o]=i,B=(e,o)=>{for(var i in o||(o={}))J.call(o,i)&&T(e,i,o[i]);if(N)for(var i of N(o))K.call(o,i)&&T(e,i,o[i]);return e},z=(e,o)=>R(e,H(o));import{p as c}from"./api.16639018761514.js";import{b as O}from"./api.16639018761512.js";import{n as I,b as L}from"./assert.1663901876151.js";import{_ as Q,A as W,r as X,o as Y,t as Z,b as r,C as x,d as m,e as S,g as a,w as s,h,x as D,k as g,B as n,i as q,F as ee,j as oe,E as F,G as le}from"./index.1663901876151.js";import"./Api.1663901876151.js";const ae=W({name:"ProjectList",components:{},setup(){const e=X({permissions:{saveProject:"project:save",delProject:"project:del",saveMember:"project:member:add",delMember:"project:member:del",saveEnv:"project:env:add"},query:{pageNum:1,pageSize:10,name:null},total:0,projects:[],btnLoading:!1,chooseId:null,chooseData:null,addProjectDialog:{title:"\u65B0\u589E\u9879\u76EE",visible:!1,form:{name:"",remark:""}},showEnvDialog:{visible:!1,chooseId:null,chooseData:null,envs:[],title:"",addVisible:!1,envForm:{name:"",remark:"",projectId:0}},showMemDialog:{visible:!1,chooseId:null,chooseData:null,query:{pageSize:8,pageNum:1,projectId:null},members:{list:[],total:null},title:"",addVisible:!1,memForm:{},accounts:[]}});Y(()=>{o()});const o=async()=>{let t=await c.projects.request(e.query);e.projects=t.list,e.total=t.total},i=t=>{e.query.pageNum=t,o()},U=t=>{t?e.addProjectDialog.form=B({},t):e.addProjectDialog.form={},e.addProjectDialog.visible=!0},V=()=>{e.addProjectDialog.visible=!1,e.addProjectDialog.form={}},$=async()=>{const t=e.addProjectDialog.form;I(t.name,"\u9879\u76EE\u540D\u4E0D\u80FD\u4E3A\u7A7A"),I(t.remark,"\u9879\u76EE\u63CF\u8FF0\u4E0D\u80FD\u4E3A\u7A7A"),await c.saveProject.request(t),F.success("\u4FDD\u5B58\u6210\u529F"),o(),V()},u=async()=>{try{await le.confirm("\u786E\u5B9A\u5220\u9664\u8BE5\u9879\u76EE?","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}),await c.delProject.request({id:e.chooseId}),F.success("\u5220\u9664\u6210\u529F"),e.chooseData=null,e.chooseId=null,o()}catch{}},w=t=>{!t||(e.chooseId=t.id,e.chooseData=t)},y=async t=>{e.showMemDialog.query.projectId=t.id,await f(),e.showMemDialog.title=`${t.name}\u7684\u6210\u5458\u4FE1\u606F`,e.showMemDialog.visible=!0},d=t=>{!t||(e.showMemDialog.chooseData=t,e.showMemDialog.chooseId=t.id)},j=async()=>{L(e.showMemDialog.chooseData,"\u8BF7\u9009\u9009\u62E9\u6210\u5458"),await c.deleteProjectMem.request(e.showMemDialog.chooseData),F.success("\u79FB\u9664\u6210\u529F"),f()},f=async()=>{const t=await c.projectMems.request(e.showMemDialog.query);e.showMemDialog.members.list=t.list,e.showMemDialog.members.total=t.total},A=async t=>{e.showEnvDialog.envs=await c.projectEnvs.request({projectId:t.id}),e.showEnvDialog.title=`${t.name}\u7684\u73AF\u5883\u4FE1\u606F`,e.showEnvDialog.visible=!0},P=t=>{!t||(e.showEnvDialog.chooseData=t,e.showEnvDialog.chooseId=t.id)},v=async()=>{L(e.showEnvDialog.chooseData,"\u8BF7\u9009\u9009\u62E9\u73AF\u5883"),await c.delProjectEnvs.request({id:e.showEnvDialog.chooseId}),F.success("\u5220\u9664\u6210\u529F"),e.showEnvDialog.envs=await c.projectEnvs.request({projectId:e.chooseId})},M=()=>{e.showMemDialog.addVisible=!0},E=async()=>{const t=e.showMemDialog.memForm;t.projectId=e.chooseData.id,I(t.accountId,"\u8BF7\u5148\u9009\u62E9\u8D26\u53F7"),await c.saveProjectMem.request(t),F.success("\u4FDD\u5B58\u6210\u529F"),f(),C()},C=()=>{e.showMemDialog.memForm={},e.showMemDialog.addVisible=!1,e.showMemDialog.chooseData=null,e.showMemDialog.chooseId=null},k=t=>{O.list.request({username:t}).then(_=>{e.showMemDialog.accounts=_.list})},p=()=>{e.showEnvDialog.addVisible=!0},l=async()=>{const t=e.showEnvDialog.envForm;t.projectId=e.chooseData.id,await c.saveProjectEnv.request(t),F.success("\u4FDD\u5B58\u6210\u529F"),e.showEnvDialog.envs=await c.projectEnvs.request({projectId:t.projectId}),b()},b=()=>{e.showEnvDialog.envForm={},e.showEnvDialog.addVisible=!1};return z(B({},Z(e)),{search:o,handlePageChange:i,choose:w,showAddProjectDialog:U,addProject:$,delProject:u,cancelAddProject:V,showMembers:y,setMemebers:f,showEnv:A,deleteEnv:v,showAddMemberDialog:M,addMember:E,chooseMember:d,deleteMember:j,cancelAddMember:C,showAddEnvDialog:p,chooseEnv:P,addEnv:l,cancelAddEnv:b,getAccount:k})}}),se={class:"project-list"},te=n("\u6DFB\u52A0"),ue=n("\u7F16\u8F91"),ne=n("\u6210\u5458\u7BA1\u7406"),de=n("\u73AF\u5883\u7BA1\u7406"),ie=n("\u5220\u9664"),re={style:{float:"right"}},me=h("i",null,null,-1),pe={class:"dialog-footer"},ce=n("\u53D6 \u6D88"),ge=n("\u786E \u5B9A"),he={class:"toolbar"},De=n("\u6DFB\u52A0"),be=n("\u5220\u9664"),we=h("i",null,null,-1),fe={class:"dialog-footer"},ve=n("\u53D6 \u6D88"),Ee=n("\u786E \u5B9A"),Fe={class:"toolbar"},ye=n("\u6DFB\u52A0"),je=n("\u79FB\u9664"),Me=h("i",null,null,-1),Ce={class:"dialog-footer"},Ve=n("\u53D6 \u6D88"),Ae=n("\u786E \u5B9A");function Pe(e,o,i,U,V,$){const u=r("el-button"),w=r("el-input"),y=r("el-radio"),d=r("el-table-column"),j=r("el-table"),f=r("el-pagination"),A=r("el-row"),P=r("el-card"),v=r("el-form-item"),M=r("el-form"),E=r("el-dialog"),C=r("el-option"),k=r("el-select"),p=x("auth");return m(),S("div",se,[a(P,null,{default:s(()=>[h("div",null,[D((m(),g(u,{onClick:e.showAddProjectDialog,type:"primary",icon:"plus"},{default:s(()=>[te]),_:1},8,["onClick"])),[[p,e.permissions.saveProject]]),D((m(),g(u,{onClick:o[0]||(o[0]=l=>e.showAddProjectDialog(e.chooseData)),disabled:e.chooseId==null,type:"primary",icon:"edit"},{default:s(()=>[ue]),_:1},8,["disabled"])),[[p,e.permissions.saveProject]]),a(u,{onClick:o[1]||(o[1]=l=>e.showMembers(e.chooseData)),disabled:e.chooseId==null,type:"success",icon:"user"},{default:s(()=>[ne]),_:1},8,["disabled"]),a(u,{onClick:o[2]||(o[2]=l=>e.showEnv(e.chooseData)),disabled:e.chooseId==null,type:"info",icon:"setting"},{default:s(()=>[de]),_:1},8,["disabled"]),D((m(),g(u,{onClick:e.delProject,disabled:e.chooseId==null,type:"danger",icon:"delete"},{default:s(()=>[ie]),_:1},8,["onClick","disabled"])),[[p,e.permissions.delProject]]),h("div",re,[a(w,{class:"mr2",placeholder:"\u8BF7\u8F93\u5165\u9879\u76EE\u540D\uFF01",style:{width:"200px"},modelValue:e.query.name,"onUpdate:modelValue":o[3]||(o[3]=l=>e.query.name=l),onClear:e.search,clearable:""},null,8,["modelValue","onClear"]),a(u,{onClick:e.search,type:"success",icon:"search"},null,8,["onClick"])])]),a(j,{data:e.projects,onCurrentChange:e.choose,ref:"table",style:{width:"100%"}},{default:s(()=>[a(d,{label:"\u9009\u62E9",width:"55px"},{default:s(l=>[a(y,{modelValue:e.chooseId,"onUpdate:modelValue":o[4]||(o[4]=b=>e.chooseId=b),label:l.row.id},{default:s(()=>[me]),_:2},1032,["modelValue","label"])]),_:1}),a(d,{prop:"name",label:"\u9879\u76EE\u540D"}),a(d,{prop:"remark",label:"\u63CF\u8FF0","min-width":"180px","show-overflow-tooltip":""}),a(d,{prop:"createTime",label:"\u521B\u5EFA\u65F6\u95F4"},{default:s(l=>[n(q(e.$filters.dateFormat(l.row.createTime)),1)]),_:1}),a(d,{prop:"creator",label:"\u521B\u5EFA\u8005"})]),_:1},8,["data","onCurrentChange"]),a(A,{style:{"margin-top":"20px"},type:"flex",justify:"end"},{default:s(()=>[a(f,{style:{"text-align":"right"},onCurrentChange:e.handlePageChange,total:e.total,layout:"prev, pager, next, total, jumper","current-page":e.query.pageNum,"onUpdate:current-page":o[5]||(o[5]=l=>e.query.pageNum=l),"page-size":e.query.pageSize},null,8,["onCurrentChange","total","current-page","page-size"])]),_:1})]),_:1}),a(E,{width:"400px",title:"\u9879\u76EE\u7F16\u8F91","before-close":e.cancelAddProject,modelValue:e.addProjectDialog.visible,"onUpdate:modelValue":o[9]||(o[9]=l=>e.addProjectDialog.visible=l)},{footer:s(()=>[h("div",pe,[a(u,{onClick:o[8]||(o[8]=l=>e.cancelAddProject())},{default:s(()=>[ce]),_:1}),a(u,{onClick:e.addProject,type:"primary"},{default:s(()=>[ge]),_:1},8,["onClick"])])]),default:s(()=>[a(M,{model:e.addProjectDialog.form,"label-width":"70px"},{default:s(()=>[a(v,{prop:"name",label:"\u9879\u76EE\u540D:",required:""},{default:s(()=>[a(w,{disabled:!!e.addProjectDialog.form.id,modelValue:e.addProjectDialog.form.name,"onUpdate:modelValue":o[6]||(o[6]=l=>e.addProjectDialog.form.name=l),"auto-complete":"off"},null,8,["disabled","modelValue"])]),_:1}),a(v,{label:"\u63CF\u8FF0:"},{default:s(()=>[a(w,{modelValue:e.addProjectDialog.form.remark,"onUpdate:modelValue":o[7]||(o[7]=l=>e.addProjectDialog.form.remark=l),"auto-complete":"off"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["before-close","modelValue"]),a(E,{width:"500px",title:e.showEnvDialog.title,modelValue:e.showEnvDialog.visible,"onUpdate:modelValue":o[15]||(o[15]=l=>e.showEnvDialog.visible=l)},{default:s(()=>[h("div",he,[D((m(),g(u,{onClick:e.showAddEnvDialog,type:"primary",icon:"plus"},{default:s(()=>[De]),_:1},8,["onClick"])),[[p,e.permissions.saveMember]]),D((m(),g(u,{onClick:e.deleteEnv,disabled:e.showEnvDialog.chooseId==null,type:"danger",icon:"delete"},{default:s(()=>[be]),_:1},8,["onClick","disabled"])),[[p,e.permissions.delProject]])]),a(j,{onCurrentChange:e.chooseEnv,border:"",data:e.showEnvDialog.envs},{default:s(()=>[a(d,{label:"\u9009\u62E9",width:"50px"},{default:s(l=>[a(y,{modelValue:e.showEnvDialog.chooseId,"onUpdate:modelValue":o[10]||(o[10]=b=>e.showEnvDialog.chooseId=b),label:l.row.id},{default:s(()=>[we]),_:2},1032,["modelValue","label"])]),_:1}),a(d,{property:"name",label:"\u73AF\u5883\u540D",width:"125"}),a(d,{property:"remark",label:"\u63CF\u8FF0",width:"125"}),a(d,{property:"createTime",label:"\u521B\u5EFA\u65F6\u95F4"},{default:s(l=>[n(q(e.$filters.dateFormat(l.row.createTime)),1)]),_:1})]),_:1},8,["onCurrentChange","data"]),a(E,{width:"400px",title:"\u6DFB\u52A0\u73AF\u5883","before-close":e.cancelAddEnv,modelValue:e.showEnvDialog.addVisible,"onUpdate:modelValue":o[14]||(o[14]=l=>e.showEnvDialog.addVisible=l)},{footer:s(()=>[h("div",fe,[a(u,{onClick:o[13]||(o[13]=l=>e.cancelAddEnv())},{default:s(()=>[ve]),_:1}),D((m(),g(u,{onClick:e.addEnv,type:"primary",loading:e.btnLoading},{default:s(()=>[Ee]),_:1},8,["onClick","loading"])),[[p,e.permissions.saveEnv]])])]),default:s(()=>[a(M,{model:e.showEnvDialog.envForm,"label-width":"70px"},{default:s(()=>[a(v,{prop:"name",label:"\u73AF\u5883\u540D:",required:""},{default:s(()=>[a(w,{modelValue:e.showEnvDialog.envForm.name,"onUpdate:modelValue":o[11]||(o[11]=l=>e.showEnvDialog.envForm.name=l),"auto-complete":"off"},null,8,["modelValue"])]),_:1}),a(v,{label:"\u63CF\u8FF0:"},{default:s(()=>[a(w,{modelValue:e.showEnvDialog.envForm.remark,"onUpdate:modelValue":o[12]||(o[12]=l=>e.showEnvDialog.envForm.remark=l),"auto-complete":"off"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["before-close","modelValue"])]),_:1},8,["title","modelValue"]),a(E,{width:"500px",title:e.showMemDialog.title,modelValue:e.showMemDialog.visible,"onUpdate:modelValue":o[22]||(o[22]=l=>e.showMemDialog.visible=l)},{default:s(()=>[h("div",Fe,[D((m(),g(u,{onClick:o[16]||(o[16]=l=>e.showAddMemberDialog()),type:"primary",icon:"plus"},{default:s(()=>[ye]),_:1})),[[p,e.permissions.saveMember]]),D((m(),g(u,{onClick:e.deleteMember,disabled:e.showMemDialog.chooseId==null,type:"danger",icon:"delete"},{default:s(()=>[je]),_:1},8,["onClick","disabled"])),[[p,e.permissions.delMember]])]),a(j,{onCurrentChange:e.chooseMember,border:"",data:e.showMemDialog.members.list},{default:s(()=>[a(d,{label:"\u9009\u62E9",width:"50px"},{default:s(l=>[a(y,{modelValue:e.showMemDialog.chooseId,"onUpdate:modelValue":o[17]||(o[17]=b=>e.showMemDialog.chooseId=b),label:l.row.id},{default:s(()=>[Me]),_:2},1032,["modelValue","label"])]),_:1}),a(d,{property:"username",label:"\u8D26\u53F7",width:"125"}),a(d,{property:"createTime",label:"\u52A0\u5165\u65F6\u95F4"},{default:s(l=>[n(q(e.$filters.dateFormat(l.row.createTime)),1)]),_:1}),a(d,{property:"creator",label:"\u5206\u914D\u8005",width:"125"})]),_:1},8,["onCurrentChange","data"]),a(f,{onCurrentChange:e.setMemebers,style:{"text-align":"center"},background:"",layout:"prev, pager, next, total, jumper",total:e.showMemDialog.members.total,"current-page":e.showMemDialog.query.pageNum,"onUpdate:current-page":o[18]||(o[18]=l=>e.showMemDialog.query.pageNum=l),"page-size":e.showMemDialog.query.pageSize},null,8,["onCurrentChange","total","current-page","page-size"]),a(E,{width:"400px",title:"\u6DFB\u52A0\u6210\u5458","before-close":e.cancelAddMember,modelValue:e.showMemDialog.addVisible,"onUpdate:modelValue":o[21]||(o[21]=l=>e.showMemDialog.addVisible=l)},{footer:s(()=>[h("div",Ce,[a(u,{onClick:o[20]||(o[20]=l=>e.cancelAddMember())},{default:s(()=>[Ve]),_:1}),D((m(),g(u,{onClick:e.addMember,type:"primary",loading:e.btnLoading},{default:s(()=>[Ae]),_:1},8,["onClick","loading"])),[[p,e.permissions.saveMember]])])]),default:s(()=>[a(M,{model:e.showMemDialog.memForm,"label-width":"70px"},{default:s(()=>[a(v,{label:"\u8D26\u53F7:"},{default:s(()=>[a(k,{style:{width:"100%"},remote:"","remote-method":e.getAccount,modelValue:e.showMemDialog.memForm.accountId,"onUpdate:modelValue":o[19]||(o[19]=l=>e.showMemDialog.memForm.accountId=l),filterable:"",placeholder:"\u8BF7\u8F93\u5165\u8D26\u53F7\u6A21\u7CCA\u641C\u7D22\u5E76\u9009\u62E9"},{default:s(()=>[(m(!0),S(ee,null,oe(e.showMemDialog.accounts,l=>(m(),g(C,{key:l.id,label:l.username,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["remote-method","modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["before-close","modelValue"])]),_:1},8,["title","modelValue"])])}var Ne=Q(ae,[["render",Pe]]);export{Ne as default};
