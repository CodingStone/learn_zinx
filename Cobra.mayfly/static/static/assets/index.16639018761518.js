var K=Object.defineProperty;var B=Object.getOwnPropertySymbols;var M=Object.prototype.hasOwnProperty,W=Object.prototype.propertyIsEnumerable;var D=(e,o,s)=>o in e?K(e,o,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[o]=s,b=(e,o)=>{for(var s in o||(o={}))M.call(o,s)&&D(e,s,o[s]);if(B)for(var s of B(o))W.call(o,s)&&D(e,s,o[s]);return e};import{P as y,A as Z,a as E,S as j,u as Q,q as V,r as I,o as X,m as Y,c as T,t as S,_ as $,f as G,U as k,V as H,W as J,X as x,E as A,Y as O,b as c,d as C,e as R,g as t,w as l,k as ee,Z as oe,h as u,z as ae,Q as U,R as L,B as q,i as ne,n as te,T as se,x as le,y as ie}from"./index.1663901876151.js";import{R as _}from"./rsa.1663901876151.js";import"./assert.1663901876151.js";const re="UseLoginCaptcha",ue="UseWartermark";async function ce(e){return await y.getConfigValue({key:e})}async function z(e,o){const s=await ce(e);return s?s=="1":o}async function de(){return await z(re,!0)}async function ge(){return await z(ue,!0)}const pe=Z({name:"AccountLogin",setup(){const e=E(),o=j(),s=Q(),g=V(null),v=V(null),n=I({useLoginCaptcha:!1,captchaImage:"",loginForm:{username:"",password:"",captcha:"",cid:""},changePwdDialog:{visible:!1,form:{username:"",oldPassword:"",newPassword:""},rules:{newPassword:[{required:!0,message:"\u8BF7\u8F93\u5165\u65B0\u5BC6\u7801",trigger:"blur"},{pattern:/^(?=.*[A-Za-z])(?=.*\d)(?=.*[`~!@#$%^&*()_+<>?:"{},.\/\\;'[\]])[A-Za-z\d`~!@#$%^&*()_+<>?:"{},.\/\\;'[\]]{8,}$/,message:"\u987B\u4E3A8\u4F4D\u4EE5\u4E0A\u4E14\u5305\u542B\u5B57\u2E9F\u2F24\u2F29\u5199+\u6570\u5B57+\u7279\u6B8A\u7B26\u53F7",trigger:"blur"}]}},rules:{username:[{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u540D",trigger:"blur"}],password:[{required:!0,message:"\u8BF7\u8F93\u5165\u5BC6\u7801",trigger:"blur"}],captcha:[{required:!0,message:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801",trigger:"blur"}]},loading:{signIn:!1,changePwd:!1}});X(async()=>{Y(async()=>{n.useLoginCaptcha=await de(),i()}),sessionStorage.removeItem("RsaPublicKey")});const i=async()=>{if(!n.useLoginCaptcha)return;let a=await y.captcha();n.captchaImage=a.base64Captcha,n.loginForm.cid=a.cid},r=T(()=>G(new Date)),p=()=>{g.value.validate(a=>{if(a)w();else return!1})},w=async()=>{n.loading.signIn=!0;let a;const d=n.loginForm.password;try{const h=b({},n.loginForm);h.password=await _(d),a=await y.login(h),k("token",a.token),k("menus",a.menus)}catch(h){n.loading.signIn=!1,n.loginForm.captcha="",h.code&&h.code==401?(n.changePwdDialog.form.username=n.loginForm.username,n.changePwdDialog.form.oldPassword=d,n.changePwdDialog.form.newPassword="",n.changePwdDialog.visible=!0):i();return}const f={username:n.loginForm.username,photo:H(n.loginForm.username),time:new Date().getTime(),permissions:a.permissions,lastLoginTime:a.lastLoginTime,lastLoginIp:a.lastLoginIp};J(f),e.dispatch("userInfos/setUserInfos",f),e.state.themeConfig.themeConfig.isRequestRoutes?(await x(),m()):(await x(),m())},m=()=>{var d;let a=r.value;(d=o.query)!=null&&d.redirect?s.push(o.query.redirect):s.push("/"),setTimeout(async()=>{n.loading.signIn=!0,A.success(`${a}\uFF0C\u6B22\u8FCE\u56DE\u6765\uFF01`),await ge()&&O(!0)},300)};return b({getCaptcha:i,currentTime:r,loginFormRef:g,changePwdFormRef:v,login:p,changePwd:()=>{v.value.validate(async a=>{if(!a)return!1;try{n.loading.changePwd=!0;const d=n.changePwdDialog.form,f=b({},d);f.oldPassword=await _(d.oldPassword),f.newPassword=await _(d.newPassword),await y.changePwd(f),A.success("\u5BC6\u7801\u4FEE\u6539\u6210\u529F, \u65B0\u5BC6\u7801\u5DF2\u586B\u5145\u81F3\u767B\u5F55\u5BC6\u7801\u6846"),n.loginForm.password=n.changePwdDialog.form.newPassword,n.changePwdDialog.visible=!1,i()}finally{n.loading.changePwd=!1}})},cancelChangePwd:()=>{n.changePwdDialog.visible=!1,n.changePwdDialog.form.newPassword="",n.changePwdDialog.form.oldPassword="",n.changePwdDialog.form.username="",i()}},S(n))}}),me=e=>(U("data-v-dcd48216"),e=e(),L(),e),fe={class:"login-content-code"},we=["src"],he=me(()=>u("span",null,"\u767B \u5F55",-1)),be={class:"dialog-footer"},ve=q("\u53D6 \u6D88"),ye=q("\u786E \u5B9A");function Pe(e,o,s,g,v,n){const i=c("el-input"),r=c("el-form-item"),p=c("el-col"),w=c("el-row"),m=c("el-button"),P=c("el-form"),F=c("el-dialog");return C(),R("div",null,[t(P,{ref:"loginFormRef",model:e.loginForm,rules:e.rules,class:"login-content-form",size:"large"},{default:l(()=>[t(r,{prop:"username"},{default:l(()=>[t(i,{type:"text",placeholder:"\u8BF7\u8F93\u5165\u7528\u6237\u540D","prefix-icon":"user",modelValue:e.loginForm.username,"onUpdate:modelValue":o[0]||(o[0]=a=>e.loginForm.username=a),clearable:"",autocomplete:"off"},null,8,["modelValue"])]),_:1}),t(r,{prop:"password"},{default:l(()=>[t(i,{type:"password",placeholder:"\u8BF7\u8F93\u5165\u5BC6\u7801","prefix-icon":"lock",modelValue:e.loginForm.password,"onUpdate:modelValue":o[1]||(o[1]=a=>e.loginForm.password=a),autocomplete:"off","show-password":""},null,8,["modelValue"])]),_:1}),e.useLoginCaptcha?(C(),ee(r,{key:0,prop:"captcha"},{default:l(()=>[t(w,{gutter:15},{default:l(()=>[t(p,{span:16},{default:l(()=>[t(i,{type:"text",maxlength:"6",placeholder:"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801","prefix-icon":"position",modelValue:e.loginForm.captcha,"onUpdate:modelValue":o[2]||(o[2]=a=>e.loginForm.captcha=a),clearable:"",autocomplete:"off",onKeyup:oe(e.login,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),t(p,{span:8},{default:l(()=>[u("div",fe,[u("img",{class:"login-content-code-img",onClick:o[3]||(o[3]=(...a)=>e.getCaptcha&&e.getCaptcha(...a)),width:"130px",height:"40px",src:e.captchaImage,style:{cursor:"pointer"}},null,8,we)])]),_:1})]),_:1})]),_:1})):ae("",!0),t(r,null,{default:l(()=>[t(m,{type:"primary",class:"login-content-submit",round:"",onClick:e.login,loading:e.loading.signIn},{default:l(()=>[he]),_:1},8,["onClick","loading"])]),_:1})]),_:1},8,["model","rules"]),t(F,{title:"\u4FEE\u6539\u5BC6\u7801",modelValue:e.changePwdDialog.visible,"onUpdate:modelValue":o[7]||(o[7]=a=>e.changePwdDialog.visible=a),"close-on-click-modal":!1,width:"450px","destroy-on-close":!0},{footer:l(()=>[u("div",be,[t(m,{onClick:e.cancelChangePwd},{default:l(()=>[ve]),_:1},8,["onClick"]),t(m,{onClick:e.changePwd,type:"primary",loading:e.loading.changePwd},{default:l(()=>[ye]),_:1},8,["onClick","loading"])])]),default:l(()=>[t(P,{model:e.changePwdDialog.form,rules:e.changePwdDialog.rules,ref:"changePwdFormRef","label-width":"65px"},{default:l(()=>[t(r,{prop:"username",label:"\u7528\u6237\u540D",required:""},{default:l(()=>[t(i,{modelValue:e.changePwdDialog.form.username,"onUpdate:modelValue":o[4]||(o[4]=a=>e.changePwdDialog.form.username=a),modelModifiers:{trim:!0},disabled:""},null,8,["modelValue"])]),_:1}),t(r,{prop:"oldPassword",label:"\u65E7\u5BC6\u7801",required:""},{default:l(()=>[t(i,{modelValue:e.changePwdDialog.form.oldPassword,"onUpdate:modelValue":o[5]||(o[5]=a=>e.changePwdDialog.form.oldPassword=a),modelModifiers:{trim:!0},autocomplete:"new-password",type:"password"},null,8,["modelValue"])]),_:1}),t(r,{prop:"newPassword",label:"\u65B0\u5BC6\u7801",required:""},{default:l(()=>[t(i,{modelValue:e.changePwdDialog.form.newPassword,"onUpdate:modelValue":o[6]||(o[6]=a=>e.changePwdDialog.form.newPassword=a),modelModifiers:{trim:!0},placeholder:"\u987B\u4E3A8\u4F4D\u4EE5\u4E0A\u4E14\u5305\u542B\u5B57\u2E9F\u2F24\u2F29\u5199+\u6570\u5B57+\u7279\u6B8A\u7B26\u53F7",type:"password",autocomplete:"new-password"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])}var _e=$(pe,[["render",Pe],["__scopeId","data-v-dcd48216"]]);const Ce={name:"LoginPage",components:{Account:_e},setup(){const e=E(),o=I({tabsActiveName:"account",isTabPaneShow:!0}),s=T(()=>e.state.themeConfig.themeConfig);return b({onTabsClick:()=>{o.isTabPaneShow=!o.isTabPaneShow},getThemeConfig:s},S(o))}},N=e=>(U("data-v-46973cfa"),e=e(),L(),e),Fe={class:"login-container"},Be={class:"login-logo"},De={class:"login-content-main"},Ve=N(()=>u("h4",{class:"login-content-title"},"mayfly-go",-1)),ke=N(()=>u("div",{class:"login-copyright"},[u("div",{class:"mb5 login-copyright-company"},"mayfly"),u("div",{class:"login-copyright-msg"},"mayfly")],-1));function xe(e,o,s,g,v,n){const i=c("Account"),r=c("el-tab-pane"),p=c("el-tabs");return C(),R("div",Fe,[u("div",Be,[u("span",null,ne(g.getThemeConfig.globalViceTitle),1)]),u("div",{class:te(["login-content",{"login-content-mobile":e.tabsActiveName==="mobile"}])},[u("div",De,[Ve,t(p,{modelValue:e.tabsActiveName,"onUpdate:modelValue":o[0]||(o[0]=w=>e.tabsActiveName=w),onTabClick:g.onTabsClick},{default:l(()=>[t(r,{label:"\u8D26\u53F7\u5BC6\u7801\u767B\u5F55",name:"account",disabled:e.tabsActiveName==="account"},{default:l(()=>[t(se,{name:"el-zoom-in-center"},{default:l(()=>[le(t(i,null,null,512),[[ie,e.isTabPaneShow]])]),_:1})]),_:1},8,["disabled"])]),_:1},8,["modelValue","onTabClick"])])],2),ke])}var Se=$(Ce,[["render",xe],["__scopeId","data-v-46973cfa"]]);export{Se as default};
