var K=Object.defineProperty,Q=Object.defineProperties;var W=Object.getOwnPropertyDescriptors;var L=Object.getOwnPropertySymbols;var X=Object.prototype.hasOwnProperty,Y=Object.prototype.propertyIsEnumerable;var M=(e,o,n)=>o in e?K(e,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[o]=n,q=(e,o)=>{for(var n in o||(o={}))X.call(o,n)&&M(e,n,o[n]);if(L)for(var n of L(o))Y.call(o,n)&&M(e,n,o[n]);return e},S=(e,o)=>Q(e,W(o));import{A as T,q as P,r as U,v as j,t as I,_ as z,E,b as i,d as g,e as A,g as t,w as u,h as k,B as m,i as R,k as v,z as _,o as Z,C as x,x as V,D as O,G as ee}from"./index.1663901876151.js";import{b as F,a as oe}from"./api.16639018761512.js";import{e as le}from"./enums.1663901876151.js";import"./Api.1663901876151.js";import"./Enum.1663901876151.js";const te=T({name:"RoleEdit",props:{visible:{type:Boolean},account:{type:[Boolean,Object]}},setup(e,{emit:o}){const n=P(null),s=U({dialogVisible:!1,btnLoading:!1,allRole:[],roles:[],query:{name:null,pageNum:1,pageSize:5},total:0});j(e,l=>{if(s.dialogVisible=l.visible,l.account&&l.account.id!=0)F.roleIds.request({id:e.account.id}).then(p=>{s.roles=p||[],c()});else return});const y=()=>{c()},w=l=>l.code.indexOf("COMMON")!=0,r=(l,p)=>{let D=s.roles;if(D.includes(p.id)){for(let $=0;$<D.length;$++)if(D[$]===p.id){D.splice($,1);break}}else D.push(p.id)},f=()=>{setTimeout(()=>{n.value.clearSelection(),s.allRole.forEach(l=>{s.roles.includes(l.id)&&n.value.toggleRowSelection(l,!0)})},50)},b=async()=>{let l=s.roles.join(",");await F.saveRoles.request({id:e.account.id,roleIds:l}),E.success("\u4FDD\u5B58\u6210\u529F!"),d()},d=()=>{s.query.pageNum=1,s.query.name=null,o("update:visible",!1),o("cancel")},h=()=>{s.query.pageNum=1,s.query.name=null,c()},c=async()=>{let l=await oe.list.request(s.query);s.allRole=l.list,s.total=l.total,f()};return S(q({},I(s)),{roleTable:n,search:c,handlePageChange:y,selectable:w,select:r,btnOk:b,cancel:d,clear:h})}}),ae={class:"account-dialog"},ue={class:"toolbar"},se={style:{float:"left"}},ne={class:"dialog-footer"},ie=m("\u53D6 \u6D88"),re=m("\u786E \u5B9A");function de(e,o,n,s,y,w){const r=i("el-input"),f=i("el-button"),b=i("el-table-column"),d=i("el-table"),h=i("el-pagination"),c=i("el-dialog");return g(),A("div",ae,[t(c,{title:e.account==null?"":"\u5206\u914D\u201C"+e.account.username+"\u201D\u7684\u89D2\u8272",modelValue:e.dialogVisible,"onUpdate:modelValue":o[4]||(o[4]=l=>e.dialogVisible=l),"before-close":e.cancel,"show-close":!1},{footer:u(()=>[k("div",ne,[t(f,{onClick:o[3]||(o[3]=l=>e.cancel())},{default:u(()=>[ie]),_:1}),t(f,{type:"primary",loading:e.btnLoading,onClick:e.btnOk},{default:u(()=>[re]),_:1},8,["loading","onClick"])])]),default:u(()=>[k("div",ue,[k("div",se,[t(r,{placeholder:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D",style:{width:"150px"},modelValue:e.query.name,"onUpdate:modelValue":o[0]||(o[0]=l=>e.query.name=l),onClear:o[1]||(o[1]=l=>e.clear()),clearable:""},null,8,["modelValue"]),t(f,{onClick:e.search,type:"success",icon:"search"},null,8,["onClick"])])]),t(d,{data:e.allRole,border:"",ref:"roleTable",onSelect:e.select,style:{width:"100%"}},{default:u(()=>[t(b,{selectable:e.selectable,type:"selection",width:"40"},null,8,["selectable"]),t(b,{prop:"name",label:"\u89D2\u8272\u540D\u79F0"}),t(b,{prop:"code",label:"\u89D2\u8272code"}),t(b,{prop:"remark",label:"\u89D2\u8272\u63CF\u8FF0"},{default:u(l=>[m(R(l.row.remark?l.row.remark:"\u6682\u65E0\u63CF\u8FF0"),1)]),_:1})]),_:1},8,["data","onSelect"]),t(h,{onCurrentChange:e.handlePageChange,style:{"text-align":"center","margin-top":"20px"},background:"",layout:"prev, pager, next, total, jumper",total:e.total,"current-page":e.query.pageNum,"onUpdate:current-page":o[2]||(o[2]=l=>e.query.pageNum=l),"page-size":e.query.pageSize},null,8,["onCurrentChange","total","current-page","page-size"])]),_:1},8,["title","modelValue","before-close"])])}var ce=z(te,[["render",de]]);const pe=T({name:"AccountEdit",props:{visible:{type:Boolean},account:{type:[Boolean,Object]},title:{type:String}},setup(e,{emit:o}){const n=P(null),s=U({dialogVisible:!1,edit:!1,form:{id:null,username:null,password:null,repassword:null},btnLoading:!1,rules:{username:[{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u540D",trigger:["change","blur"]}]}});j(e,r=>{r.account?(s.form=q({},r.account),s.edit=!0):s.form={},s.dialogVisible=r.visible});const y=async()=>{n.value.validate(r=>{if(r)F.save.request(s.form).then(()=>{E.success("\u64CD\u4F5C\u6210\u529F"),o("val-change",s.form),s.btnLoading=!0,setTimeout(()=>{s.btnLoading=!1},1e3),n.value.resetFields(),s.form={}});else return E.error("\u8868\u5355\u586B\u5199\u6709\u8BEF"),!1})},w=()=>{o("update:visible",!1),o("cancel")};return S(q({},I(s)),{accountForm:n,btnOk:y,cancel:w})}}),me={class:"account-dialog"},ge={class:"dialog-footer"},fe=m("\u53D6 \u6D88"),be=m("\u786E \u5B9A");function he(e,o,n,s,y,w){const r=i("el-input"),f=i("el-form-item"),b=i("el-form"),d=i("el-button"),h=i("el-dialog");return g(),A("div",me,[t(h,{title:e.title,modelValue:e.dialogVisible,"onUpdate:modelValue":o[3]||(o[3]=c=>e.dialogVisible=c),"before-close":e.cancel,"show-close":!1,width:"35%","destroy-on-close":!0},{footer:u(()=>[k("div",ge,[t(d,{onClick:o[2]||(o[2]=c=>e.cancel())},{default:u(()=>[fe]),_:1}),t(d,{type:"primary",loading:e.btnLoading,onClick:e.btnOk},{default:u(()=>[be]),_:1},8,["loading","onClick"])])]),default:u(()=>[t(b,{model:e.form,ref:"accountForm",rules:e.rules,"label-width":"85px"},{default:u(()=>[t(f,{prop:"username",label:"\u7528\u6237\u540D:",required:""},{default:u(()=>[t(r,{disabled:e.edit,modelValue:e.form.username,"onUpdate:modelValue":o[0]||(o[0]=c=>e.form.username=c),modelModifiers:{trim:!0},placeholder:"\u8BF7\u8F93\u5165\u8D26\u53F7\u7528\u6237\u540D\uFF0C\u5BC6\u7801\u9ED8\u8BA4\u4E0E\u8D26\u53F7\u540D\u4E00\u81F4","auto-complete":"off"},null,8,["disabled","modelValue"])]),_:1}),e.edit?(g(),v(f,{key:0,prop:"password",label:"\u5BC6\u7801:",required:""},{default:u(()=>[t(r,{type:"password",modelValue:e.form.password,"onUpdate:modelValue":o[1]||(o[1]=c=>e.form.password=c),modelModifiers:{trim:!0},placeholder:"\u8BF7\u8F93\u5165\u5BC6\u7801",autocomplete:"new-password"},null,8,["modelValue"])]),_:1})):_("",!0)]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue","before-close"])])}var De=z(pe,[["render",he]]);const ve=T({name:"AccountList",components:{RoleEdit:ce,AccountEdit:De},setup(){const e=U({chooseId:null,chooseData:null,query:{pageNum:1,pageSize:10},datas:[],total:0,showRoleDialog:{title:"",visible:!1,accountRoles:[]},showResourceDialog:{title:"",visible:!1,resources:[],defaultProps:{children:"children",label:"name"}},roleDialog:{visible:!1,account:null,roles:[]},accountDialog:{visible:!1,data:null}});Z(()=>{n()});const o=l=>{!l||(e.chooseId=l.id,e.chooseData=l)},n=async()=>{let l=await F.list.request(e.query);e.datas=l.list,e.total=l.total},s=async l=>{let p=e.showResourceDialog;p.title='"'+l.username+'" \u7684\u83DC\u5355&\u6743\u9650',p.resources=[],p.resources=await F.resources.request({id:l.id}),p.visible=!0},y=async l=>{let p=e.showRoleDialog;p.title='"'+l.username+'" \u7684\u89D2\u8272\u4FE1\u606F',p.accountRoles=await F.roles.request({id:l.id}),p.visible=!0},w=async l=>{let p=l.id,D=l.status==-1?1:-1;await F.changeStatus.request({id:p,status:D}),E.success("\u64CD\u4F5C\u6210\u529F"),n()},r=l=>{e.query.pageNum=l,n()},f=()=>{e.chooseId||E.error("\u8BF7\u9009\u62E9\u8D26\u53F7"),e.roleDialog.visible=!0,e.roleDialog.account=e.chooseData},b=(l=!1)=>{l?e.accountDialog.data=null:e.accountDialog.data=e.chooseData,e.accountDialog.visible=!0},d=()=>{e.roleDialog.visible=!1,e.roleDialog.account=null,n()},h=()=>{e.accountDialog.visible=!1,n()},c=async()=>{try{await ee.confirm("\u786E\u5B9A\u5220\u9664\u8BE5\u8D26\u53F7?","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}),await F.del.request({id:e.chooseId}),E.success("\u5220\u9664\u6210\u529F"),e.chooseData=null,e.chooseId=null,n()}catch{}};return S(q({},I(e)),{enums:le,search:n,choose:o,showResources:s,showRoles:y,changeStatus:w,handlePageChange:r,roleEdit:f,editAccount:b,cancel:d,valChange:h,deleteAccount:c})}}),ye={class:"role-list"},we=m("\u6DFB\u52A0"),Ce=m("\u7F16\u8F91"),Fe=m("\u89D2\u8272\u5206\u914D"),_e=m("\u5220\u9664"),ke={style:{float:"right"}},$e=k("i",null,null,-1),Be=m("\u6B63\u5E38"),Ve=m("\u7981\u7528"),Re=m("\u89D2\u8272"),Ee=m("\u83DC\u5355&\u6743\u9650"),qe=m("\u7981\u7528"),Ae=m("\u542F\u7528"),Se={class:"custom-tree-node"},Ne={key:0},Te={key:1,style:{color:"#67c23a"}};function Ue(e,o,n,s,y,w){const r=i("el-button"),f=i("el-input"),b=i("el-radio"),d=i("el-table-column"),h=i("el-tag"),c=i("el-link"),l=i("el-table"),p=i("el-pagination"),D=i("el-row"),$=i("el-card"),N=i("el-dialog"),G=i("el-tree"),H=i("role-edit"),J=i("account-edit"),B=x("auth");return g(),A("div",ye,[t($,null,{default:u(()=>[V((g(),v(r,{type:"primary",icon:"plus",onClick:o[0]||(o[0]=a=>e.editAccount(!0))},{default:u(()=>[we]),_:1})),[[B,"account:add"]]),V((g(),v(r,{disabled:e.chooseId==null,onClick:o[1]||(o[1]=a=>e.editAccount(!1)),type:"primary",icon:"edit"},{default:u(()=>[Ce]),_:1},8,["disabled"])),[[B,"account:add"]]),V((g(),v(r,{disabled:e.chooseId==null,onClick:o[2]||(o[2]=a=>e.roleEdit()),type:"success",icon:"setting"},{default:u(()=>[Fe]),_:1},8,["disabled"])),[[B,"account:saveRoles"]]),V((g(),v(r,{disabled:e.chooseId==null,onClick:o[3]||(o[3]=a=>e.deleteAccount()),type:"danger",icon:"delete"},{default:u(()=>[_e]),_:1},8,["disabled"])),[[B,"account:del"]]),k("div",ke,[t(f,{class:"mr2",placeholder:"\u8BF7\u8F93\u5165\u8D26\u53F7\u540D",size:"small",style:{width:"300px"},modelValue:e.query.username,"onUpdate:modelValue":o[4]||(o[4]=a=>e.query.username=a),onClear:o[5]||(o[5]=a=>e.search()),clearable:""},null,8,["modelValue"]),t(r,{onClick:o[6]||(o[6]=a=>e.search()),type:"success",icon:"search",size:"small"})]),t(l,{data:e.datas,ref:"table",onCurrentChange:e.choose,"show-overflow-tooltip":""},{default:u(()=>[t(d,{label:"\u9009\u62E9",width:"55px"},{default:u(a=>[t(b,{modelValue:e.chooseId,"onUpdate:modelValue":o[7]||(o[7]=C=>e.chooseId=C),label:a.row.id},{default:u(()=>[$e]),_:2},1032,["modelValue","label"])]),_:1}),t(d,{prop:"username",label:"\u7528\u6237\u540D","min-width":"115"}),t(d,{align:"center",prop:"status",label:"\u72B6\u6001","min-width":"65"},{default:u(a=>[a.row.status==1?(g(),v(h,{key:0,type:"success"},{default:u(()=>[Be]),_:1})):_("",!0),a.row.status==-1?(g(),v(h,{key:1,type:"danger"},{default:u(()=>[Ve]),_:1})):_("",!0)]),_:1}),t(d,{"min-width":"160",prop:"lastLoginTime",label:"\u6700\u540E\u767B\u5F55\u65F6\u95F4","show-overflow-tooltip":""},{default:u(a=>[m(R(e.$filters.dateFormat(a.row.lastLoginTime)),1)]),_:1}),t(d,{"min-width":"115",prop:"creator",label:"\u521B\u5EFA\u8D26\u53F7"}),t(d,{"min-width":"160",prop:"createTime",label:"\u521B\u5EFA\u65F6\u95F4","show-overflow-tooltip":""},{default:u(a=>[m(R(e.$filters.dateFormat(a.row.createTime)),1)]),_:1}),t(d,{label:"\u67E5\u770B\u66F4\u591A","min-width":"150"},{default:u(a=>[t(c,{onClick:O(C=>e.showRoles(a.row),["prevent"]),type:"success"},{default:u(()=>[Re]),_:2},1032,["onClick"]),t(c,{class:"ml5",onClick:O(C=>e.showResources(a.row),["prevent"]),type:"info"},{default:u(()=>[Ee]),_:2},1032,["onClick"])]),_:1}),t(d,{label:"\u64CD\u4F5C","min-width":"200px"},{default:u(a=>[a.row.status==1?V((g(),v(r,{key:0,onClick:C=>e.changeStatus(a.row),type:"danger",icom:"tickets",size:"small",plain:""},{default:u(()=>[qe]),_:2},1032,["onClick"])),[[B,"account:changeStatus"]]):_("",!0),a.row.status==-1?V((g(),v(r,{key:1,type:"success",onClick:C=>e.changeStatus(a.row),size:"small",plain:""},{default:u(()=>[Ae]),_:2},1032,["onClick"])),[[B,"account:changeStatus"]]):_("",!0)]),_:1})]),_:1},8,["data","onCurrentChange"]),t(D,{style:{"margin-top":"20px"},type:"flex",justify:"end"},{default:u(()=>[t(p,{style:{"text-align":"right"},onCurrentChange:e.handlePageChange,total:e.total,layout:"prev, pager, next, total, jumper","current-page":e.query.pageNum,"onUpdate:current-page":o[8]||(o[8]=a=>e.query.pageNum=a),"page-size":e.query.pageSize},null,8,["onCurrentChange","total","current-page","page-size"])]),_:1})]),_:1}),t(N,{width:"500px",title:e.showRoleDialog.title,modelValue:e.showRoleDialog.visible,"onUpdate:modelValue":o[9]||(o[9]=a=>e.showRoleDialog.visible=a)},{default:u(()=>[t(l,{border:"",data:e.showRoleDialog.accountRoles},{default:u(()=>[t(d,{property:"name",label:"\u89D2\u8272\u540D",width:"125"}),t(d,{property:"creator",label:"\u5206\u914D\u8D26\u53F7",width:"125"}),t(d,{property:"createTime",label:"\u5206\u914D\u65F6\u95F4"},{default:u(a=>[m(R(e.$filters.dateFormat(a.row.createTime)),1)]),_:1})]),_:1},8,["data"])]),_:1},8,["title","modelValue"]),t(N,{title:e.showResourceDialog.title,modelValue:e.showResourceDialog.visible,"onUpdate:modelValue":o[10]||(o[10]=a=>e.showResourceDialog.visible=a),width:"400px"},{default:u(()=>[t(G,{style:{height:"50vh",overflow:"auto"},data:e.showResourceDialog.resources,"node-key":"id",props:e.showResourceDialog.defaultProps,"expand-on-click-node":!0},{default:u(({node:a,data:C})=>[k("span",Se,[C.type==e.enums.ResourceTypeEnum.MENU.value?(g(),A("span",Ne,R(a.label),1)):_("",!0),C.type==e.enums.ResourceTypeEnum.PERMISSION.value?(g(),A("span",Te,R(a.label),1)):_("",!0)])]),_:1},8,["data","props"])]),_:1},8,["title","modelValue"]),t(H,{visible:e.roleDialog.visible,"onUpdate:visible":o[11]||(o[11]=a=>e.roleDialog.visible=a),account:e.roleDialog.account,onCancel:o[12]||(o[12]=a=>e.cancel())},null,8,["visible","account"]),t(J,{visible:e.accountDialog.visible,"onUpdate:visible":o[13]||(o[13]=a=>e.accountDialog.visible=a),account:e.accountDialog.data,"onUpdate:account":o[14]||(o[14]=a=>e.accountDialog.data=a),onValChange:o[15]||(o[15]=a=>e.valChange())},null,8,["visible","account"])])}var je=z(ve,[["render",Ue]]);export{je as default};
