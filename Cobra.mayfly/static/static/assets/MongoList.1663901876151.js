var X=Object.defineProperty,Y=Object.defineProperties;var Z=Object.getOwnPropertyDescriptors;var T=Object.getOwnPropertySymbols;var x=Object.prototype.hasOwnProperty,ee=Object.prototype.propertyIsEnumerable;var U=(e,o,p)=>o in e?X(e,o,{enumerable:!0,configurable:!0,writable:!0,value:p}):e[o]=p,j=(e,o)=>{for(var p in o||(o={}))x.call(o,p)&&U(e,p,o[p]);if(T)for(var p of T(o))ee.call(o,p)&&U(e,p,o[p]);return e},M=(e,o)=>Y(e,Z(o));import{m as y}from"./api.16639018761516.js";import{p as N}from"./api.16639018761514.js";import{m as le}from"./api.16639018761513.js";import{A as O,q as ae,r as P,v as oe,t as H,_ as G,E as $,b as r,d as b,e as V,g as l,w as a,h as I,F as q,j as A,k as B,z as L,B as n,o as te,i as g,G as ne}from"./index.1663901876151.js";import{f as ie}from"./format.1663901876151.js";import"./Api.1663901876151.js";const se=O({name:"MongoEdit",props:{visible:{type:Boolean},projects:{type:Array},mongo:{type:[Boolean,Object]},title:{type:String}},setup(e,{emit:o}){const p=ae(null),d=P({dialogVisible:!1,projects:[],envs:[],sshTunnelMachineList:[],form:{id:null,name:null,uri:null,enableSshTunnel:-1,sshTunnelMachineId:null,project:null,projectId:null,envId:null,env:null},btnLoading:!1,rules:{projectId:[{required:!0,message:"\u8BF7\u9009\u62E9\u9879\u76EE",trigger:["change","blur"]}],envId:[{required:!0,message:"\u8BF7\u9009\u62E9\u73AF\u5883",trigger:["change","blur"]}],name:[{required:!0,message:"\u8BF7\u8F93\u5165\u540D\u79F0",trigger:["change","blur"]}],uri:[{required:!0,message:"\u8BF7\u8F93\u5165mongo uri",trigger:["change","blur"]}]}});oe(e,async i=>{d.dialogVisible=i.visible,d.dialogVisible&&(d.projects=i.projects,i.mongo?(F(i.mongo.projectId),d.form=j({},i.mongo)):(d.envs=[],d.form={db:0}),S())});const S=async()=>{if(d.form.enableSshTunnel==1&&d.sshTunnelMachineList.length==0){const i=await le.list.request({pageNum:1,pageSize:100});d.sshTunnelMachineList=i.list}},F=async i=>{d.envs=await N.projectEnvs.request({projectId:i})},f=i=>{for(let c of d.projects)c.id==i&&(d.form.project=c.name);d.form.envId=null,d.form.env=null,d.envs=[],F(i)},v=i=>{for(let c of d.envs)c.id==i&&(d.form.env=c.name)},D=async()=>{p.value.validate(async i=>{if(i){const c=j({},d.form);y.saveMongo.request(c).then(()=>{$.success("\u4FDD\u5B58\u6210\u529F"),o("val-change",d.form),d.btnLoading=!0,setTimeout(()=>{d.btnLoading=!1},1e3),C()})}else return $.error("\u8BF7\u6B63\u786E\u586B\u5199\u4FE1\u606F"),!1})},C=()=>{o("update:visible",!1),o("cancel")};return M(j({},H(d)),{mongoForm:p,changeProject:f,getSshTunnelMachines:S,changeEnv:v,btnOk:D,cancel:C})}}),ue=n(" \u673A\u5668: "),re={class:"dialog-footer"},de=n("\u53D6 \u6D88"),ge=n("\u786E \u5B9A");function me(e,o,p,d,S,F){const f=r("el-option"),v=r("el-select"),D=r("el-form-item"),C=r("el-input"),i=r("el-checkbox"),c=r("el-col"),h=r("el-form"),E=r("el-button"),_=r("el-dialog");return b(),V("div",null,[l(_,{title:e.title,modelValue:e.dialogVisible,"onUpdate:modelValue":o[7]||(o[7]=s=>e.dialogVisible=s),"before-close":e.cancel,"close-on-click-modal":!1,width:"38%","destroy-on-close":!0},{footer:a(()=>[I("div",re,[l(E,{onClick:o[6]||(o[6]=s=>e.cancel())},{default:a(()=>[de]),_:1}),l(E,{type:"primary",loading:e.btnLoading,onClick:e.btnOk},{default:a(()=>[ge]),_:1},8,["loading","onClick"])])]),default:a(()=>[l(h,{model:e.form,ref:"mongoForm",rules:e.rules,"label-width":"85px"},{default:a(()=>[l(D,{prop:"projectId",label:"\u9879\u76EE",required:""},{default:a(()=>[l(v,{style:{width:"100%"},modelValue:e.form.projectId,"onUpdate:modelValue":o[0]||(o[0]=s=>e.form.projectId=s),placeholder:"\u8BF7\u9009\u62E9\u9879\u76EE",onChange:e.changeProject,filterable:""},{default:a(()=>[(b(!0),V(q,null,A(e.projects,s=>(b(),B(f,{key:s.id,label:`${s.name} [${s.remark}]`,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])]),_:1}),l(D,{prop:"envId",label:"\u73AF\u5883",required:""},{default:a(()=>[l(v,{onChange:e.changeEnv,style:{width:"100%"},modelValue:e.form.envId,"onUpdate:modelValue":o[1]||(o[1]=s=>e.form.envId=s),placeholder:"\u8BF7\u9009\u62E9\u73AF\u5883"},{default:a(()=>[(b(!0),V(q,null,A(e.envs,s=>(b(),B(f,{key:s.id,label:`${s.name} [${s.remark}]`,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["onChange","modelValue"])]),_:1}),l(D,{prop:"name",label:"\u540D\u79F0",required:""},{default:a(()=>[l(C,{modelValue:e.form.name,"onUpdate:modelValue":o[2]||(o[2]=s=>e.form.name=s),modelModifiers:{trim:!0},placeholder:"\u8BF7\u8F93\u5165\u540D\u79F0","auto-complete":"off"},null,8,["modelValue"])]),_:1}),l(D,{prop:"uri",label:"uri",required:""},{default:a(()=>[l(C,{type:"textarea",rows:2,modelValue:e.form.uri,"onUpdate:modelValue":o[3]||(o[3]=s=>e.form.uri=s),modelModifiers:{trim:!0},placeholder:"\u5F62\u5982 mongodb://username:password@host1:port1","auto-complete":"off"},null,8,["modelValue"])]),_:1}),l(D,{prop:"enableSshTunnel",label:"SSH\u96A7\u9053:"},{default:a(()=>[l(c,{span:3},{default:a(()=>[l(i,{onChange:e.getSshTunnelMachines,modelValue:e.form.enableSshTunnel,"onUpdate:modelValue":o[4]||(o[4]=s=>e.form.enableSshTunnel=s),"true-label":1,"false-label":-1},null,8,["onChange","modelValue"])]),_:1}),e.form.enableSshTunnel==1?(b(),B(c,{key:0,span:2},{default:a(()=>[ue]),_:1})):L("",!0),e.form.enableSshTunnel==1?(b(),B(c,{key:1,span:19},{default:a(()=>[l(v,{style:{width:"100%"},modelValue:e.form.sshTunnelMachineId,"onUpdate:modelValue":o[5]||(o[5]=s=>e.form.sshTunnelMachineId=s),placeholder:"\u8BF7\u9009\u62E9SSH\u96A7\u9053\u673A\u5668"},{default:a(()=>[(b(!0),V(q,null,A(e.sshTunnelMachineList,s=>(b(),B(f,{key:s.id,label:`${s.ip}:${s.port} [${s.name}]`,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):L("",!0)]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue","before-close"])])}var ce=G(se,[["render",me]]);const pe=O({name:"MongoList",components:{MongoEdit:ce},setup(){const e=P({projects:[],list:[],total:0,currentId:null,currentData:null,query:{pageNum:1,pageSize:10,prjectId:null,clusterId:null},mongoEditDialog:{visible:!1,data:null,title:"\u65B0\u589Emongo"},databaseDialog:{visible:!1,data:[],title:"",statsDialog:{visible:!1,data:{},title:""}},collectionsDialog:{database:"",visible:!1,data:[],title:"",statsDialog:{visible:!1,data:{},title:""}},createCollectionDialog:{visible:!1,form:{name:""}}});te(async()=>{h()});const o=u=>{e.query.pageNum=u,h()},p=u=>{!u||(e.currentId=u.id,e.currentData=u)},d=async u=>{e.databaseDialog.data=(await y.databases.request({id:u})).Databases,e.databaseDialog.title="\u6570\u636E\u5E93\u5217\u8868",e.databaseDialog.visible=!0},S=async u=>{e.databaseDialog.statsDialog.data=await y.runCommand.request({id:e.currentId,database:u,command:{dbStats:1}}),e.databaseDialog.statsDialog.title=`'${u}' stats`,e.databaseDialog.statsDialog.visible=!0},F=async u=>{e.collectionsDialog.database=u,e.collectionsDialog.data=[],f(u),e.collectionsDialog.title=`'${u}' \u96C6\u5408`,e.collectionsDialog.visible=!0},f=async u=>{const m=await y.collections.request({id:e.currentId,database:u}),k=[];for(let w of m)k.push({name:w});e.collectionsDialog.data=k},v=async u=>{e.collectionsDialog.statsDialog.data=await y.runCommand.request({id:e.currentId,database:e.collectionsDialog.database,command:{collStats:u}}),e.collectionsDialog.statsDialog.title=`'${u}' stats`,e.collectionsDialog.statsDialog.visible=!0},D=async u=>{await y.runCommand.request({id:e.currentId,database:e.collectionsDialog.database,command:{drop:u}}),$.success("\u96C6\u5408\u5220\u9664\u6210\u529F"),f(e.collectionsDialog.database)},C=()=>{e.createCollectionDialog.visible=!0},i=async()=>{const u=e.createCollectionDialog.form;await y.runCommand.request({id:e.currentId,database:e.collectionsDialog.database,command:{create:u.name}}),$.success("\u96C6\u5408\u521B\u5EFA\u6210\u529F"),e.createCollectionDialog.visible=!1,e.createCollectionDialog.form={},f(e.collectionsDialog.database)},c=async()=>{try{await ne.confirm("\u786E\u5B9A\u5220\u9664\u8BE5mongo?","\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"}),await y.deleteMongo.request({id:e.currentId}),$.success("\u5220\u9664\u6210\u529F"),e.currentData=null,e.currentId=null,h()}catch{}},h=async()=>{const u=await y.mongoList.request(e.query);e.list=u.list,e.total=u.total},E=async()=>{e.projects=await N.accountProjects.request(null)},_=async(u=!1)=>{await E(),u?(e.mongoEditDialog.data=null,e.mongoEditDialog.title="\u65B0\u589Emongo"):(e.mongoEditDialog.data=e.currentData,e.mongoEditDialog.title="\u4FEE\u6539mongo"),e.mongoEditDialog.visible=!0},s=()=>{e.currentId=null,e.currentData=null,h()};return M(j({},H(e)),{getProjects:E,search:h,handlePageChange:o,choose:p,showDatabases:d,showDatabaseStats:S,showCollections:F,showCollectionStats:v,onDeleteCollection:D,showCreateCollectionDialog:C,onCreateCollection:i,formatByteSize:ie,deleteMongo:c,editMongo:_,valChange:s})}}),fe=n("\u6DFB\u52A0"),be=n("\u7F16\u8F91"),De=n("\u5220\u9664"),he={style:{float:"right"}},ve=I("i",null,null,-1),Ce=n("\u6570\u636E\u5E93"),ye=n("stats"),Ee=n("\u96C6\u5408"),we=n("\u65B0\u5EFA"),Se=n("stats"),Fe=n("\u5220\u9664"),ze=n("\u53D6 \u6D88"),Be=n("\u786E \u5B9A");function Ve(e,o,p,d,S,F){const f=r("el-button"),v=r("el-option"),D=r("el-select"),C=r("el-radio"),i=r("el-table-column"),c=r("el-link"),h=r("el-table"),E=r("el-pagination"),_=r("el-row"),s=r("el-card"),u=r("el-divider"),m=r("el-descriptions-item"),k=r("el-descriptions"),w=r("el-dialog"),R=r("el-popconfirm"),J=r("el-input"),K=r("el-form-item"),Q=r("el-form"),W=r("mongo-edit");return b(),V("div",null,[l(s,null,{default:a(()=>[l(f,{type:"primary",icon:"plus",onClick:o[0]||(o[0]=t=>e.editMongo(!0)),plain:""},{default:a(()=>[fe]),_:1}),l(f,{type:"primary",icon:"edit",disabled:e.currentId==null,onClick:o[1]||(o[1]=t=>e.editMongo(!1)),plain:""},{default:a(()=>[be]),_:1},8,["disabled"]),l(f,{type:"danger",icon:"delete",disabled:e.currentId==null,onClick:e.deleteMongo,plain:""},{default:a(()=>[De]),_:1},8,["disabled","onClick"]),I("div",he,[l(D,{onFocus:e.getProjects,modelValue:e.query.projectId,"onUpdate:modelValue":o[2]||(o[2]=t=>e.query.projectId=t),placeholder:"\u8BF7\u9009\u62E9\u9879\u76EE",filterable:"",clearable:""},{default:a(()=>[(b(!0),V(q,null,A(e.projects,t=>(b(),B(v,{key:t.id,label:`${t.name} [${t.remark}]`,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["onFocus","modelValue"]),l(f,{class:"ml5",onClick:e.search,type:"success",icon:"search"},null,8,["onClick"])]),l(h,{data:e.list,style:{width:"100%"},onCurrentChange:e.choose,stripe:""},{default:a(()=>[l(i,{label:"\u9009\u62E9",width:"60px"},{default:a(t=>[l(C,{modelValue:e.currentId,"onUpdate:modelValue":o[3]||(o[3]=z=>e.currentId=z),label:t.row.id},{default:a(()=>[ve]),_:2},1032,["modelValue","label"])]),_:1}),l(i,{prop:"project",label:"\u9879\u76EE",width:""}),l(i,{prop:"env",label:"\u73AF\u5883",width:""}),l(i,{prop:"name",label:"\u540D\u79F0",width:""}),l(i,{prop:"uri",label:"\u8FDE\u63A5uri","min-width":"150","show-overflow-tooltip":""},{default:a(t=>[n(g(t.row.uri.split("@")[1]),1)]),_:1}),l(i,{prop:"createTime",label:"\u521B\u5EFA\u65F6\u95F4","min-width":"150"},{default:a(t=>[n(g(e.$filters.dateFormat(t.row.createTime)),1)]),_:1}),l(i,{prop:"creator",label:"\u521B\u5EFA\u4EBA"}),l(i,{label:"\u64CD\u4F5C",width:""},{default:a(t=>[l(c,{type:"primary",onClick:z=>e.showDatabases(t.row.id),plain:"",size:"small",underline:!1},{default:a(()=>[Ce]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data","onCurrentChange"]),l(_,{style:{"margin-top":"20px"},type:"flex",justify:"end"},{default:a(()=>[l(E,{style:{"text-align":"right"},onCurrentChange:e.handlePageChange,total:e.total,layout:"prev, pager, next, total, jumper","current-page":e.query.pageNum,"onUpdate:current-page":o[4]||(o[4]=t=>e.query.pageNum=t),"page-size":e.query.pageSize},null,8,["onCurrentChange","total","current-page","page-size"])]),_:1})]),_:1}),l(w,{width:"800px",title:e.databaseDialog.title,modelValue:e.databaseDialog.visible,"onUpdate:modelValue":o[6]||(o[6]=t=>e.databaseDialog.visible=t)},{default:a(()=>[l(h,{data:e.databaseDialog.data,size:"small"},{default:a(()=>[l(i,{"min-width":"130",property:"Name",label:"\u5E93\u540D"}),l(i,{"min-width":"90",property:"SizeOnDisk",label:"size"},{default:a(t=>[n(g(e.formatByteSize(t.row.SizeOnDisk)),1)]),_:1}),l(i,{"min-width":"80",property:"Empty",label:"\u662F\u5426\u4E3A\u7A7A"}),l(i,{"min-width":"80",label:"\u64CD\u4F5C"},{default:a(t=>[l(c,{type:"success",onClick:z=>e.showDatabaseStats(t.row.Name),plain:"",size:"small",underline:!1},{default:a(()=>[ye]),_:2},1032,["onClick"]),l(u,{direction:"vertical","border-style":"dashed"}),l(c,{type:"primary",onClick:z=>e.showCollections(t.row.Name),plain:"",size:"small",underline:!1},{default:a(()=>[Ee]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),l(w,{width:"700px",title:e.databaseDialog.statsDialog.title,modelValue:e.databaseDialog.statsDialog.visible,"onUpdate:modelValue":o[5]||(o[5]=t=>e.databaseDialog.statsDialog.visible=t)},{default:a(()=>[l(k,{title:"\u5E93\u72B6\u6001\u4FE1\u606F",column:3,border:"",size:"small"},{default:a(()=>[l(m,{label:"db","label-align":"right",align:"center"},{default:a(()=>[n(g(e.databaseDialog.statsDialog.data.db),1)]),_:1}),l(m,{label:"collections","label-align":"right",align:"center"},{default:a(()=>[n(g(e.databaseDialog.statsDialog.data.collections),1)]),_:1}),l(m,{label:"objects","label-align":"right",align:"center"},{default:a(()=>[n(g(e.databaseDialog.statsDialog.data.objects),1)]),_:1}),l(m,{label:"indexes","label-align":"right",align:"center"},{default:a(()=>[n(g(e.databaseDialog.statsDialog.data.indexes),1)]),_:1}),l(m,{label:"avgObjSize","label-align":"right",align:"center"},{default:a(()=>[n(g(e.formatByteSize(e.databaseDialog.statsDialog.data.avgObjSize)),1)]),_:1}),l(m,{label:"dataSize","label-align":"right",align:"center"},{default:a(()=>[n(g(e.formatByteSize(e.databaseDialog.statsDialog.data.dataSize)),1)]),_:1}),l(m,{label:"totalSize","label-align":"right",align:"center"},{default:a(()=>[n(g(e.formatByteSize(e.databaseDialog.statsDialog.data.totalSize)),1)]),_:1}),l(m,{label:"storageSize","label-align":"right",align:"center"},{default:a(()=>[n(g(e.formatByteSize(e.databaseDialog.statsDialog.data.storageSize)),1)]),_:1}),l(m,{label:"fsTotalSize","label-align":"right",align:"center"},{default:a(()=>[n(g(e.formatByteSize(e.databaseDialog.statsDialog.data.fsTotalSize)),1)]),_:1}),l(m,{label:"fsUsedSize","label-align":"right",align:"center"},{default:a(()=>[n(g(e.formatByteSize(e.databaseDialog.statsDialog.data.fsUsedSize)),1)]),_:1}),l(m,{label:"indexSize","label-align":"right",align:"center"},{default:a(()=>[n(g(e.formatByteSize(e.databaseDialog.statsDialog.data.indexSize)),1)]),_:1})]),_:1})]),_:1},8,["title","modelValue"])]),_:1},8,["title","modelValue"]),l(w,{width:"600px",title:e.collectionsDialog.title,modelValue:e.collectionsDialog.visible,"onUpdate:modelValue":o[8]||(o[8]=t=>e.collectionsDialog.visible=t)},{default:a(()=>[I("div",null,[l(f,{onClick:e.showCreateCollectionDialog,type:"primary",icon:"plus",size:"small"},{default:a(()=>[we]),_:1},8,["onClick"])]),l(h,{border:"",stripe:"",data:e.collectionsDialog.data,size:"small"},{default:a(()=>[l(i,{prop:"name",label:"\u540D\u79F0","show-overflow-tooltip":""}),l(i,{"min-width":"80",label:"\u64CD\u4F5C"},{default:a(t=>[l(c,{type:"success",onClick:z=>e.showCollectionStats(t.row.name),plain:"",size:"small",underline:!1},{default:a(()=>[Se]),_:2},1032,["onClick"]),l(u,{direction:"vertical","border-style":"dashed"}),l(R,{onConfirm:z=>e.onDeleteCollection(t.row.name),title:"\u786E\u5B9A\u5220\u9664\u8BE5\u96C6\u5408?"},{reference:a(()=>[l(c,{type:"danger",plain:"",size:"small",underline:!1},{default:a(()=>[Fe]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"]),l(w,{width:"700px",title:e.collectionsDialog.statsDialog.title,modelValue:e.collectionsDialog.statsDialog.visible,"onUpdate:modelValue":o[7]||(o[7]=t=>e.collectionsDialog.statsDialog.visible=t)},{default:a(()=>[l(k,{title:"\u96C6\u5408\u72B6\u6001\u4FE1\u606F",column:3,border:"",size:"small"},{default:a(()=>[l(m,{label:"ns","label-align":"right",span:2,align:"center"},{default:a(()=>[n(g(e.collectionsDialog.statsDialog.data.ns),1)]),_:1}),l(m,{label:"count","label-align":"right",align:"center"},{default:a(()=>[n(g(e.collectionsDialog.statsDialog.data.count),1)]),_:1}),l(m,{label:"avgObjSize","label-align":"right",align:"center"},{default:a(()=>[n(g(e.formatByteSize(e.collectionsDialog.statsDialog.data.avgObjSize)),1)]),_:1}),l(m,{label:"nindexes","label-align":"right",align:"center"},{default:a(()=>[n(g(e.collectionsDialog.statsDialog.data.nindexes),1)]),_:1}),l(m,{label:"size","label-align":"right",align:"center"},{default:a(()=>[n(g(e.formatByteSize(e.collectionsDialog.statsDialog.data.size)),1)]),_:1}),l(m,{label:"totalSize","label-align":"right",align:"center"},{default:a(()=>[n(g(e.formatByteSize(e.collectionsDialog.statsDialog.data.totalSize)),1)]),_:1}),l(m,{label:"storageSize","label-align":"right",align:"center"},{default:a(()=>[n(g(e.formatByteSize(e.collectionsDialog.statsDialog.data.storageSize)),1)]),_:1}),l(m,{label:"freeStorageSize","label-align":"right",align:"center"},{default:a(()=>[n(g(e.formatByteSize(e.collectionsDialog.statsDialog.data.freeStorageSize)),1)]),_:1})]),_:1})]),_:1},8,["title","modelValue"])]),_:1},8,["title","modelValue"]),l(w,{width:"400px",title:"\u65B0\u5EFA\u96C6\u5408",modelValue:e.createCollectionDialog.visible,"onUpdate:modelValue":o[11]||(o[11]=t=>e.createCollectionDialog.visible=t),"destroy-on-close":!0},{footer:a(()=>[I("div",null,[l(f,{onClick:o[10]||(o[10]=t=>e.createCollectionDialog.visible=!1)},{default:a(()=>[ze]),_:1}),l(f,{onClick:e.onCreateCollection,type:"primary"},{default:a(()=>[Be]),_:1},8,["onClick"])])]),default:a(()=>[l(Q,{model:e.createCollectionDialog.form,"label-width":"70px"},{default:a(()=>[l(K,{prop:"name",label:"\u96C6\u5408\u540D",required:""},{default:a(()=>[l(J,{modelValue:e.createCollectionDialog.form.name,"onUpdate:modelValue":o[9]||(o[9]=t=>e.createCollectionDialog.form.name=t),clearable:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),l(W,{onValChange:e.valChange,projects:e.projects,title:e.mongoEditDialog.title,visible:e.mongoEditDialog.visible,"onUpdate:visible":o[12]||(o[12]=t=>e.mongoEditDialog.visible=t),mongo:e.mongoEditDialog.data,"onUpdate:mongo":o[13]||(o[13]=t=>e.mongoEditDialog.data=t)},null,8,["onValChange","projects","title","visible","mongo"])])}var Me=G(pe,[["render",Ve]]);export{Me as default};
